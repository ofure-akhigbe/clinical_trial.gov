---
insta---
title: "A machine learning model in R to predict the likelihood of Singapore participting in a clinical trial based on several variables characteristics"
format: pdf
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
1 + 1
```

You can add options to executable code like this

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).

```{r}
library(clintrialx)
library(tidyverse)
library(dplyr)
library(quanteda)
library(tidytext)




#Raw clinical trial data from clincaltrial.gov(ct_gov)

ct_gov_raw <- ctg_bulk_fetch(location = NULL)

#check for duplicated Trial ID
duplicate_trial_ID <- ct_gov_raw%>%
add_count(`NCT Number`)%>%
mutate(duplicate_trial = ifelse(n >1, "Duplicate", "Unique"))
#mutate (duplicates_trial = Duplicate_count >1)

#count the total number of duplicated trial ID
total_duplicated_trial_ID <- duplicate_trial_ID %>%
filter(n >1) %>%
nrow()

total_duplicated_trial_ID

#No duplicates 


#Dealing with missing data

#1) Blank row: Identify blank rows and remove those rows with the following missing varibles: Therapuetic Area, Phase, Intervention and Sponsor. This was done because these are key predictors. To help train the model

#none were identified
missing_data_clinical_trial <-ct_gov_raw %>%
filter(!if_all(c(`Conditions`, Phases, `Interventions`, Sponsor, Locations, `Study Status`, `Study Type`), ~ .== ""))

#2) missing data: NA
missing_data_2_clinical_trial <- missing_data_clinical_trial %>%
filter(if_all(c(`Conditions`, Phases, Interventions, Locations), ~ is.na(.)))

ct_gov_data <- missing_data_clinical_trial%>%
filter(!if_all(c(`Conditions`, Phases, `Interventions`, Locations), ~ is.na(.)))

#change dataset to lowercase for easier analysis

mapping_1_ct_gov <- ct_gov_data%>%
mutate(Sponsor = tolower(Sponsor))

#Sponsor Mapping:Sponsor Type
mapping_2_ct_gov <-ct_gov_data%>%
mutate(Sponsor_Type =case_when(str_detect(Sponsor, "university|University|hospital|hospital|college|universitaire|universidade|universiteit
|school|national cancer centre, singapore
|m.d. anderson cancer center|Universidad|Universität|Langone|Anderson|Hershey
|Mayo|The Cleveland Clinic|Universitat|Università
|Hospices Civils de Lyon|Institut|Institutet|Postgraduate|Centre|Center|Université") ~ "Academic", str_detect(Sponsor, "Ministry|Naval|Army|US Department of Veterans Affairs|Military|Centers for Disease Control and Prevention
|Center for Disease Control and Prevention
|Defense and Veterans Center for Integrative Pain Management|National") ~ "Government", str_detect(Sponsor, "Company|Technologies|Pharmaceuticals|Pharmaceutical|Biopharmaceuticals
|Therapeutics|Abbive|AbbVie|GlaxoSmithKline|LLC|Enterprises|Sanofi|Samsung|GmbH|Biopharma
|Roche|Immunotherapeutics|Laboratories|Pfizer|Takeda
|Bristol-Myers Squibb|Biogen|AstraZeneca|Merck|Bayer|Biotech|Novo
|UnitedHealth Group|Biosciences|Amgen|Pharma|Abbott|Novartis|Baxter|Gilead|Quidel
|Boehringer Ingelheim|Biopharm|Pharm|Genentech|Corporation|Biomedical|Technology|Unilever
|Laboratoires|Ltd|Bioscience|Inc|Limited|Daiichi|GE Healthcare") ~ "Industry", TRUE ~ "Others"))

#Therapeutic Area Mapping

mapping_3_ct_gov <-mapping_2_ct_gov%>%
mutate(Therapeutic_Area = case_when(str_detect(`Study Title`, "Vaccine") ~ "Vaccine",str_detect(Conditions, "cancer|glioblastoma|glioma|carcinoma|melanoma|neoplasm|neuroblastoma|neoplasms
|sarcoma") ~ "Oncology", str_detect(Conditions, "chronic cidney diseases|renal disease|kidney disease") ~ "Nephrology", str_detect(Conditions, "heart|blood vessel diseases
|heart failure|hypertension") ~ "Cardiovascular", str_detect(Conditions, "Autoimmune|Rheumatoid Arthritis|Arthritis|Psoriasis|Osteoarthritis") ~ "Immunology", str_detect(Conditions, "Virus|HIV|Hiv|Bacteria|Parasites|Malaria|Dengue|TB|Tuberculosis
|COVID-19|Coronavirus") ~ "Infectious Diseases", str_detect(Conditions, "Brain|Nerve|Nerve Disorders|Alzheimers|Parkinson|Multiple Sclerosis|Traumatic Brain injury|Stroke|Dementia|Alzheimer|ALS") ~ "Neurology", str_detect(Conditions, "Depression|PTSD|Schizophrenia|Anxiety") ~ "Psychiatry/Mental Health", str_detect(Conditions, "Diabetes|Bone Diseases|Metabolic Disorders|Obesity|diabetes|Insulin|insulin") ~ "Metabolic/Endocrinology", str_detect(Conditions, "Asthma|Pulmonary|Respiratory|COPD|Pneumonitis") ~ "Respiratory", str_detect(Conditions, "Blood Disorders|Anemia|Sickel|Hemophilia|Thrombocytopenia|Myeloma|Leukemia") ~ "Hematology", str_detect(Conditions, "Liver|Hepatitis") ~ "Hepatology", str_detect(Conditions, "Vaccine|Vaccines") ~ "Vaccine", TRUE ~ "Others"))

#Study Status Mapping

mapping_4_ct_gov <-mapping_3_ct_gov%>%
mutate(Enrollment_Status = case_when(str_detect(`Study Status`, "COMPLETED|ACTIVE_NOT_RECRUITING|TERMINATED|SUSPENDED|WITHDRAWN|ENROLLING_BY_INVITATION|UNKNOW") ~ "Actual", str_detect(`Study Status`, "RECRUITING|NOT_YET_RECRUITING|NO_LONGER_AVAILABLE|APPRROVED_FOR_MARKETING|AVAILABLE|TEMORARILY_NOT_AVAILABLE") ~ "Anticipated", TRUE ~ "Anticipated"))

#Data tranformation: Intervention -> Investigational Product
transform_1_ct_gov <- mapping_4_ct_gov%>%
mutate(Investigational_Product = str_extract(Interventions, "^[^:]+"))

#Data tranformation: Investigational Product (removal of underscore)
transform_2_ct_gov <-transform_1_ct_gov%>%
mutate(Investigational_Product= str_replace_all(Investigational_Product, "[\\_]", " ")) 

#check data type for dataset
str(transform_2_ct_gov)

#Data tranformation:Primary Outcome Measures > tokenization of text and removal of punctuation and numbers and symbols

transform_3_ct_gov <- transform_2_ct_gov%>%
mutate(Primary_Outcome_Measures_1 = corpus(`Primary Outcome Measures`), Primary_Outcome_Measures_2 =tokens(`Primary Outcome Measures`, remove_punct = TRUE, remove_numbers = TRUE, remove_symbols = TRUE)
 %>% as.list())

#Data tranformation:Primary Outcome Measures > convert text in column Primary_Outcome_Measures_2 to lowercase

transform_4_ct_gov <- transform_3_ct_gov%>%
mutate(Primary_Outcome_Measures_3 = tolower(Primary_Outcome_Measures_2))


```

```{}
```

```         
```
